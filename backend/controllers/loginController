
require('dotenv').config();

const db = require('../models')
user_model = db.user
const bcrypt = require('bcrypt')
const jwt = require('jsonwebtoken')
async function loginUser(req, res) {

    const { email, password } = req.body
    if (!email || !password) {
        return res.status(400).json({ message: "email and password are required" })
    }
    const user = await user_model.findOne({
        where: { email: email }
    })
    if (user == null)
        return res.status(401).json({ message: "Invalid email or password" })


    match = await bcrypt.compare(password, user.password)
    if (match == false) {
        console.log('invalid pass')
        return res.status(401).json({ message: "Invalid email or password" })
    }

    user_info = { user_id: user.user_id, email: user.email, name: user.name }
    const accessToken = jwt.sign(user_info, process.env.ACCESS_TOKEN_SECRET, { expiresIn: '30m' })
    res.json({ accessToken: accessToken })

}

module.exports = { loginUser }